
  <head>
    <title>opros</title>
      {% extends "base.html" %}
    {% block content %}
  </head>
  <body>
      <h2>{{QuestionForm[PageNumber].text}}? Вопрос номер: {{PageNumber}}</h2>
      <form action="{{PageNumber + 1}}" method="post">
          {% for t in Threats %}
          <p>t.text</p>
          {% endfor %}
          <div class="checkboxes" id="checkboxes">
          {% for q in Options%}
          <p><input type="checkbox" class="box" name="{{q.id}}" value="{{q.text}}" onchange="pickInfoSystem(value)"><label>{{q}}</label></p>
          {% endfor %}
          </div>
          <div class="buttons" id="next_prev">
          <a href="{{ url_for('quest', page = PageNumber-1) }}" id="next_page"> Предыдущий вопрос</a>
              {% if PageNumber != Questionslength - 1%}
              <button id="show_resbutton">Следующий вопрос</button>
              {% endif %}
          </div>
      </form>
      <form action="result">
      {% if PageNumber == Questionslength - 1%}
      <button id="result_button" onclick="makeRequest()">показать результаты</button>
      {% endif %}
      </form>
  <script>
      var boxes = document.getElementsByClassName('box');

function save() {
  for(let i = 0; i <= boxes.length; i++){
      try {
          localStorage.setItem(boxes[i].value, boxes[i].checked);

      }
      catch (e){
          console.log(e)
      }
  }
}
//for loading
for(let i = 0; i <= boxes; i++){
  if(localStorage.length > 0){
    var checked = JSON.parse(localStorage.getItem(boxes[i].value));
    boxes[i].checked = checked;
  }
}
window.addEventListener('change', save);

function createQuest(quests, options, numb)//создание дополнительных вопросов для выбора модели
{
    var boxes = document.getElementsByClassName('box');
            if (boxes[numb].checked == true) {
                for (let i = 1; i <= Object.keys(quests).length; i++) {
                    const paragraphElementHead = document.createElement("p");
                    const head = document.createElement("h3");
                    paragraphElementHead.className = 'paragraph_label' + String(numb)
                    head.className = 'head_label_' + String(numb)
                    head.innerHTML = quests["quest_" + String(i)];
                    paragraphElementHead.appendChild(head);
                    document.getElementById('checkboxes').appendChild(paragraphElementHead)
                    for (let j = 1; j <= Object.keys(options).length; j++) {
                        if (options["quest_" + String(i) + "_" + String(j)] != undefined)
                        {
                            const paragraphElement = document.createElement("p");
                            const input = document.createElement("input");
                            const label = document.createElement("label");
                            input.type = 'checkbox';
                            input.id = String(numb);
                            input.className = 'box';
                            input.value = options["quest_" + String(i) + '_' + String(j)];
                            input.setAttribute("onchange","pickInfoSystem(value)")
                            label.id = 'label_' + String(numb);
                            label.className = 'checkbox_label' + String(numb)
                            label.innerHTML = options["quest_" + String(i) + '_' + String(j)];
                            label.insertBefore(input, label.firstChild);
                            paragraphElement.appendChild(input);
                            paragraphElement.appendChild(label);
                            paragraphElementHead.appendChild(paragraphElement);
                        }
                    }
                    document.getElementById('checkboxes').appendChild(paragraphElementHead);
                }
            }
            if (boxes[numb].checked == false) {
                const headsLabel = document.getElementsByClassName('paragraph_label' + String(numb));
                for (let i = headsLabel.length; i >= 0; i--) {
                    try {
                        headsLabel[i].remove();
                    } catch (e) {
                        console.log(e);
                    }
                }
            }
}

function pickInfoSystem(value)
{
    const gis_quests = {'quest_1': 'Выберите масштаб ИС', 'quest_2': 'Выберите уровень значимости информации'}
    const gis_options = {'quest_1_1': 'Федеральный', 'quest_1_2': 'Региональный', 'quest_1_3': 'Обьектовый',
                            'quest_2_1': 'УЗН1', 'quest_2_2': 'УЗН2', 'quest_2_3': 'УЗН3'}
    const ispdn_quests = {'quest_1': 'Выберите категорию ПД', 'quest_2': 'Имеются ли собственные сотрудники в компании/организации',
                            'quest_3': 'Выберите количество субьектов ПД', 'quest_4': 'Выберите тип актуальных угроз'}

    const ispdn_options = {'quest_1_1': 'Специальные','quest_1_2': 'Биометрические','quest_1_3': 'Иные','quest_1_4': 'Общедоступные',
                            'quest_2_1': 'Да','quest_2_2': 'Нет',
                            'quest_3_1': '>100 тыс.','quest_3_2': '<100 тыс.','quest_4_1': '1','quest_4_2': '2','quest_4_3': '3'}
    const kii_quests = {'quest_1': 'Выберите значимость КИИ '}
    const kii_options = {'quest_1_1': 'Социальная значимость','quest_1_2': 'Политическая значимость',
                        'quest_1_3': 'Экономическая значимость','quest_1_4': 'Экологическая значимость',
                        'quest_1_5': 'Значимость для обеспечения обороны страны, безопасности государства и правопорядка'}

    const social_quests = {'quest_1': 'Социальная значимость'}

    const social_options = {'quest_1_1': 'Причинение ущерба жизни и здоровью людей (человек)','quest_1_2': ' Прекращение или нарушение функционирования объектов обеспечения жизнедеятельности населения, в \n' +
            'том числе объектов водоснабжения и канализации, очистки сточных вод, тепло- и электроснабжения, \n' +
            'гидротехнических сооружений, оцениваемые:) на территории, на которой возможно \n' +
            'нарушение обеспечения \n' +
            'жизнедеятельности населения',
                        'quest_1_3': 'Прекращение или нарушение функционирования объектов транспортной инфраструктуры, оцениваемые:','quest_1_4': 'Прекращение или нарушение функционирования сети связи, оцениваемые:',
                        'quest_1_5': 'Отсутствие доступа к государственной\n' +
                            'услуге, оцениваемое в максимальном\n' +
                            'допустимом времени, в течение которого\n' +
                            'государственная услуга может быть\n' +
                            'недоступна для получателей такой услуги\n' +
                            '(часов) ', 'quest_1_6': 'Прекращение или нарушение функционирования объектов обеспечения жизнедеятельности населения, в \n' +
            'том числе объектов водоснабжения и канализации, очистки сточных вод, тепло- и электроснабжения, \n' +
            'гидротехнических сооружений, оцениваемые:по количеству людей, условия \n' +
            'жизнедеятельности которых могут быть \n' +
            'нарушены (тыс. человек)'}
    const political_quests =  {'quest_1': 'Политическая значимость'}
    const politcal_options = {'quest_1_1': 'Прекращение или нарушение\n' +
            'функционирования государственного\n' +
            'органа в части невыполнения\n' +
            'возложенной на него функции\n' +
            '(полномочия)\n', 'quest_1_2': 'Нарушение условий международного\n' +
            'договора РФ, срыв переговоров или\n' +
            'подписания планируемого к заключению\n' +
            'международного договора РФ,\n' +
            'оцениваемые по уровню международного\n' +
            'договора РФ\n'}


    const page = {{PageNumber}};
    const infoSystem = document.getElementsByClassName("box");
    if (page == 0)
    {
       switch (value){
           case 'ГИС':
               createQuest(gis_quests, gis_options, 0);
               break;
           case 'ИСПДн':
               createQuest(ispdn_quests, ispdn_options, 1);
               break;
           case 'КИИ':
               createQuest(kii_quests, kii_options, 2);
               break;
           case 'Социальная значимость':
               createQuest(social_quests, social_options, 3);
               break;
           case 'Политическая значимость':
               createQuest(political_quests, politcal_options, 4)

       }
    }

}
  function makeRequest() {
      const httpRequest = new XMLHttpRequest();

      if (!httpRequest) {
      alert('Giving up :( Cannot create an XMLHTTP instance');
      return false;
    }
    httpRequest.open('POST', 'result');
    const data = JSON.stringify(localStorage);
    httpRequest.send(data);
    window.location.replace('/quest/show_result/result_id');
  }
  </script>
  </body>
  {% endblock %}
</html>